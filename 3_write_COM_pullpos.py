import os

ion = '' #ENTER ION HERE
wd = '/scratch/btw47/US/POPE/%s/1_pulling/' % ion

files = os.listdir(wd)
iters = []

#--ATOM NUMBERS (LIPID == POPE)--
if ion == 'acd':
	lastatom = 28
	lipids = '87,212,337,462,587,712,837,962,1087,1212,1337,1462,1587,1712,1837,1962,2087,2212,2337,2462,2587,2712,2837,2962,3087,3212,3337,3462,3587,3712,3837,3962,4087,4212,4337,4462,4587,4712,4837,4962,5087,5212,5337,5462,5587,5712,5837,5962,6087,6212,6337,6462,6587,6712,6837,6962,7087,7212,7337,7462,7587,7712,7837,7962,8087,8212,8337,8462,8587,8712,8837,8962,9087,9212,9337,9462,9587,9712,9837,9962,10087,10212,10337,10462,10587,10712,10837,10962,11087,11212,11337,11462,11587,11712,11837,11962,12087,12212,12337,12462,12587,12712,12837,12962,13087,13212,13337,13462,13587,13712,13837,13962,14087,14212,14337,14462,14587,14712,14837,14962,15087,15212,15337,15462,15587,15712,15837,15962,'

elif ion == 'cho':
	lastatom = 21
	lipids = '80,205,330,455,580,705,830,955,1080,1205,1330,1455,1580,1705,1830,1955,2080,2205,2330,2455,2580,2705,2830,2955,3080,3205,3330,3455,3580,3705,3830,3955,4080,4205,4330,4455,4580,4705,4830,4955,5080,5205,5330,5455,5580,5705,5830,5955,6080,6205,6330,6455,6580,6705,6830,6955,7080,7205,7330,7455,7580,7705,7830,7955,8080,8205,8330,8455,8580,8705,8830,8955,9080,9205,9330,9455,9580,9705,9830,9955,10080,10205,10330,10455,10580,10705,10830,10955,11080,11205,11330,11455,11580,11705,11830,11955,12080,12205,12330,12455,12580,12705,12830,12955,13080,13205,13330,13455,13580,13705,13830,13955,14080,14205,14330,14455,14580,14705,14830,14955,15080,15205,15330,15455,15580,15705,15830,15955,'

elif ion == 'ger':
	lastatom = 27
	lipids = '86,211,336,461,586,711,836,961,1086,1211,1336,1461,1586,1711,1836,1961,2086,2211, 2336,2461,2586,2711,2836,2961,3086,3211,3336,3461,3586,3711,3836,3961,4086,4211,4336,4461,4586,4711,4836,4961,5086,5211,5336,5461,5586,5711,5836,5961,6086,6211,6336,6461,6586,6711,6836,6961,7086,7211,7336,7461,7586,7711,7836,7961,8086,8211,8336,8461,8586,8711,8836,8961,9086,9211,9336,9461,9586,9711,9836,9961,10086,10211,10336,10461,10586,10711,10836,10961,11086,11211,11336,11461,11586,11711,11836,11961,12086,12211,12336,12461,12586,12711,12836,12961,13086,13211,13336,13461,13586,13711,13836,13961,14086,14211,14336,14461,14586,14711,14836,14961,15086,15211,15336,15461,15586,15711,15836,15961,'

atomlist = []

for x in xrange(1, lastatom + 1):
	atomlist.append(str(x))

ionatoms = ', '.join(atomlist)
#--------------------

for f in files:
	if f[:12] == 'COM_pull_pos':
	#if f[-4:] == '.RST' and f.split('_')[2][:3] == 'pos':
		iteration = f.split('pos')[1].split('.')[0]
		iters.append(int(iteration))

if len(iters) > 0:
	hi_iter = max(iters)
	next_iter = hi_iter + 1
	
	dist = os.popen('tail -n 1 05_Pull_distneg%s.dat' % hi_iter).read().split()[1]	
	end_dist = float(dist) + 3.2
	with open('COM_pull_pos%s.RST' % next_iter, 'w') as ff:
		ff.write('''&rst
iat=-1,-1,
r2=%s,
rk2=1.1,
r2a=%s,
iresid=0,
fxyz=0,0,1,
outxyz=1,
igr1=%s,
igr2=%s
/
''' % (dist, end_dist, ionatoms, lipids))

else:
	with open('COM_pull_pos0.RST', 'w') as ff:
		ff.write('''&rst
iat=-1,-1,
r2=0.0,
rk2=1.1,
r2a=3.2,
iresid=0,
fxyz=0,0,1,
outxyz=1,
igr1=%s,
igr2=%s
/
''' % (ionatoms, lipids))
